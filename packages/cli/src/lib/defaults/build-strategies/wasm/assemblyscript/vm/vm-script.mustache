set -e

{{#polywrap_linked_packages}}
json -I -f package.json -e 'this.dependencies["{{name}}"]="../linked-packages/{{name}}"'
{{/polywrap_linked_packages}}
{{#polywrap_module}}
yarn
chmod -R g+wX .
asc {{dir}}/wrap/entry.ts \
    --path ./node_modules \
    --outFile ./build/wrap.wasm \
    --use abort={{dir}}/wrap/entry/wrapAbort \
    --optimize --importMemory \
    --runtime stub \
    --runPasses asyncify

chmod -R g+wX .
{{/polywrap_module}}