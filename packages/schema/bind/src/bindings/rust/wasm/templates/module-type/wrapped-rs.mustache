{{#moduleType}}
{{#methods.length}}
use polywrap_wasm_rs::{
  wrap_load_env
};

use crate::{
    {{#methods}}
    Args{{#toUpper}}{{name}}{{/toUpper}},
    deserialize_{{#toLower}}{{name}}{{/toLower}}_args,
    serialize_{{#toLower}}{{name}}{{/toLower}}_result{{^last}},{{/last}}
    {{/methods}}
};
{{/methods.length}}
{{/moduleType}}

{{#envType}}
use crate::Env;
{{/envType}}
use crate::module::{IModule, Module};

{{#moduleType}}
{{#methods}}
pub fn {{#toLower}}{{name}}{{/toLower}}_wrapped<Module: IModule>(module: &mut Module, args: &[u8], env_size: u32) -> Vec<u8> {
    {{#env}}
    {{#required}}
    if env_size == 0 {
        panic!("Environment is not set, and it is required by method 'objectMethod'");
    }

    let env_buf = wrap_load_env(env_size);
    module.set_env(Env::from_buffer(&env_buf).unwrap());

    {{/required}}
    {{^required}}
    if env_size > 0 {
      let env_buf = wrap_load_env(env_size);
      module.set_env(Env::from_buffer(&env_buf).unwrap());
    }

    {{/required}}
    {{/env}}
    {{#arguments.length}}
    match deserialize_{{#toLower}}{{name}}{{/toLower}}_args(args) {
        Ok(args) => {
    {{/arguments.length}}
            let result = module.{{#detectKeyword}}{{#toLower}}{{name}}{{/toLower}}{{/detectKeyword}}(Args{{#toUpper}}{{name}}{{/toUpper}} {
                {{#arguments}}
                {{#detectKeyword}}{{#toLower}}{{name}}{{/toLower}}{{/detectKeyword}}: args.{{#detectKeyword}}{{#toLower}}{{name}}{{/toLower}}{{/detectKeyword}},
                {{/arguments}}
            });
            match result {
                Ok(res) => {
            serialize_{{#toLower}}{{name}}{{/toLower}}_result({{#return}}&{{/return}}res).unwrap()
                }
                Err(e) => {
                    panic!("{}", e.to_string())
                }
            }
    {{#arguments.length}}
        }
        Err(e) => {
            panic!("{}", e.to_string())
        }
    }
    {{/arguments.length}}
}
{{^last}}

{{/last}}
{{/methods}}
{{/moduleType}}